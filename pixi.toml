[workspace]
channels = ["conda-forge"]
conda-pypi-map = {conda-forge = ".mapping.json"}
name = "codeaster-src"
platforms = ["linux-64"]
version = "0.1.0"

[pypi-options]
index-url = "https://nexus.retd.edf.fr/repository/pypi-all/simple"

[tasks]
configure = {cmd = [
  "CC=mpicc",
  "CXX=mpicxx",
  "FC=mpif90",
  "./configure",
  "--enable-mpi",
  "--med-libs='medfwrap medC'",
  "--disable-metis",
], env = {BUILD = "debug", PREFIX_ROOT = "$HOME/.install/pixi"}}

build = {cmd = ["make"], env = {BUILD = "debug"}}
install = {depends-on = ["build"]}
make = {cmd = "make", env = {BUILD = "debug"}}

[dependencies]
mpi = "==1.0"
python = "3.11.*"
# compilers = "1.7.*"
blas = {version = "*", build = "openblas"}
clang-format = ">=20.1.4,<21"
gcc = "12.2.*"
gfortran = "12.2.*"
gmsh = ">=4.13.1,<5"
gxx = "12.2.*"
hdf5 = ">=1.14,<2"
ipython = ">=9.0.2,<10"
libmed = {version = "4.1.*", build = "mpi_openmpi*"}
libptscotch = ">7"
make = ">=4.4.1,<5"
mpi4py = "4.0.*"
mumps-mpi = ">5.4,<5.9"
numpy = "1.24.*"
openmpi = ">=5.0.7,<6"
petsc = ">3.17,<3.22"
petsc4py = ">=3.21.6,<4"
pyyaml = ">=6.0.2,<7"
ruff = ">=0.11.1,<0.12"
scalapack = ">=2.2.0,<3"
scipy = ">=1.15.2,<2"
slepc = "*"
slepc4py = ">=3.21.2,<4"
sphinx = "<7"
zlib = ">=1.3.1,<2"

[feature.dbg.dependencies]
debugpy = "*"
py-spy = ">=0.4.0,<0.5"

[feature.rtd.dependencies]
numpy = "1.24.*"
sphinx = "*"
sphinx-rtd-theme = "*"

[feature.rtd.tasks]
builddoc = {cmd = "python -m sphinx -T -b html -d ../build/mpidebug/doc/doctrees -D language=en . ", cwd = "doc"}

[environments]
dbg = ["dbg"]
rtd = {features = ["rtd"], no-default-feature = true}
